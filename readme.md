# Автоматизация обработки чеков торговой сети
В проекте реализована генерация данных продаж торговой сети,
автоматизация сбора и хранения информации для анализа данных.

Задание на разработку здесь:[Описание задачи](./task.md) 

## Структура репозитория
- Папка data - примеры сгенерированных выгрузок
- Папка sql - DDL команды для создания БД `user_and_db_create.sql` и скрипт для создания таблиц `create_tbl.py`.
- В корне репозитория:
    * `config.ini` - файл конфигурации для подключения к серверу postgresql
    * `add_task.sh` - скрипт создания заданий cron
    * `sales_data_gen.py` - скрипт генерации выгрузок касс из магазинов
    * `sales_data_loader.py` - скрипт обработки файлов выгрузок касс и загрузки данных в БД
    * `requirements.txt` - файл зависимостей python

## Развёртывание на сервере Linux

После подключения к серверу

1. перейти в домашнюю папку (или другую)
    * `cd ~`
2. скопировать репозиторий git
    * `git clone https://`
3. создать виртуальное окружение python
    * `python -m venv venv`
4. установить зависимости библиотек python
    * `pip install -r requirements.txt`
5. установить postgresql
    * `sudo apt update`
    * `sudo apt-get -y install postgresql`
6. Создать пользователя и БД
    * выполнить в psql DDL команды из файла [/sql/user_and_db_create.sql](./sql/user_and_db_create.sql) 
    * Запустить скрипт создания таблиц 
        * `python ./sql/create_tbl.py`
    
7. Запустить скрипт создания заданий cron
    * сделать файл исполняемым: `chmod +x add_task.sh`
    * выполнить скрипт `sudo add_task.sh`


## Этапы работы

### Настройки 
В файле `config.ini` задаются параметры подключения к БД

### Генерация данных каас магазинов
Генерация данных производится каждый день кроме воскресенья в 3:00. Имя файла: Формат файла:

### Обработка и загрузка в БД
Загрузка данных производится ежедневно в 4:00. Успешно загруженные файлы удаляются.

### Логирование
При загрузке данных формируется лог-файл в папке ./log. Старые логи удаляются по истечени 10 дней.

Пример работы log-файла
![Пример](./img/)
